# Create Pods Declaratively

## Pod Basics
- **1 pod = 1 container = 1 process**

## Imperative vs Declarative Resource Management

### Imperative
- Running commands directly on the shell
- Simple but not suitable for production
- Example:
  ```bash
  kubectl run frontend --image=nginx
  kubectl get pods
  kubectl describe pod frontend
  kubectl get pods -o wide
  curl 172.17.189.65
  kubectl delete pod frontend
  ```

### Declarative
- Writing YAML files for Kubernetes resources
- Great for production, can be shared with peers, and used in CI/CD pipelines
- Preferred approach for production environments

## Creating Pods Declaratively

### Basic Pod YAML
Reference: https://kubernetes.io/docs/concepts/workloads/pods/

Create a file `simple-pod.yaml`:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx
    image: nginx:1.14.2
    ports:
    - containerPort: 80
```

**Commands:**
```bash
kubectl create -f simple-pod.yaml
kubectl get pods -o wide
kubectl describe pod nginx
```

**Delete the pod:**
```bash
kubectl delete -f simple-pod.yaml  # Preferred in production
kubectl delete pod nginx          # Not recommended for production
```

### Multiple Resources in Single YAML
Use `---` to separate resources:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: webapp
spec:
  containers:
  - name: checkers
    image: nginx:1.14.2
    ports:
    - containerPort: 80
---
apiVersion: v1
kind: Pod
metadata:
  name: dbapp
spec:
  containers:
  - name: checkers
    image: redis
```

**Important:** When deleting multiple resources, be careful:
```bash
kubectl create -f simple-pod.yaml
kubectl get pods -o wide

# WARNING: This deletes ALL resources in the file
# kubectl delete -f simple-pod.yaml
```

### Multi-Container Pod (Not Recommended)
While possible, it's not a best practice to run multiple containers in a single pod:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: webapp
spec:
  containers:
  - name: checkers
    image: nginx:1.14.2
    ports:
    - containerPort: 80
---
apiVersion: v1
kind: Pod
metadata:
  name: dbapp
spec:
  containers:
  - name: checkers
    image: redis
  - name: checkerstwo
    image: nginx:latest
```

**Output example:**
```
bosun@manager:~/yaml$ kubectl get pods -o wide
NAME     READY   STATUS    RESTARTS   AGE   IP               NODE      NOMINATED NODE   READINESS GATES
dbapp    2/2     Running   0          99s   172.17.189.67    worker2   <none>           <none>
webapp   1/1     Running   0          99s   172.17.235.131   worker1   <none>           <none>
```

**Note:** `2/2` under READY means both containers in dbapp are running.

## Environment Variables

For containers that require environment variables (like MySQL):

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mysql
spec:
  containers:
  - name: mysql
    image: mysql:latest
    env:
    - name: MYSQL_ROOT_PASSWORD
      value: "tuesday"
```

**Important:** Always define required environment variables in the YAML file. Containers that need env vars won't work properly without them.

## Labels

Labels are key-value pairs used to organize and select resources.

### Bookshelf Application Pods

**Frontend Pod:**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: bookshelf-front
  labels:
    name: nginx
    managed-by: devops
    component: frontend
    version: "10"
    part-of: bookshelf
    instance: may2023
    client: abc
    env: prod
spec:
  containers:
  - name: nginx
    image: nginx:latest
```

**Backend Pod:**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: bookshelf-back
  labels:
    name: redis
    managed-by: dbteam
    component: backend
    version: "5"
    part-of: bookshelf
    instance: nov2024
    client: abc
    env: prod
spec:
  containers:
  - name: redis
    image: redis
```

### Employee Application Pods

**Frontend Pod:**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: employee-front
  labels:
    name: apache
    managed-by: sre
    component: frontend
    version: "5"
    part-of: employee
    instance: jan2024
    client: xyz
    env: prod
spec:
  containers:
  - name: nginx
    image: nginx:latest
```

**Backend Pod:**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: employee-back
  labels:
    name: redis
    managed-by: sre
    component: backend
    version: "5"
    part-of: employee
    instance: jan2021
    client: xyz
    env: dev
spec:
  containers:
  - name: redis
    image: redis
```

### Store Application Pods

**Frontend Pod:**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: store-front
  labels:
    name: httpd
    managed-by: devops
    component: frontend
    version: "6.3"
    part-of: store
    instance: jan2024
    client: xyz
    env: prod
spec:
  containers:
  - name: nginx
    image: nginx:latest
```

**Backend Pod:**
```yaml
apiVersion: v1
kind: Pod
metadata:
  name: store-back
  labels:
    name: redis
    managed-by: db
    component: backend
    version: "5"
    part-of: store
    instance: jan2021
    client: xyz
    env: test
spec:
  containers:
  - name: redis
    image: redis
```

## Working with Labels

### View Labels
```bash
kubectl get pods --show-labels
```

### Filter by Specific Labels
```bash
kubectl get pods -L client -L env -L component
```

### Label Selectors

**Pods not in production:**
```bash
kubectl get pods -l "env!=prod" -L env
```

**Pods in production:**
```bash
kubectl get pods -l "env=prod" -L env
```

**Pods in production with client xyz:**
```bash
kubectl get pods -l "env=prod,client=xyz" -L env -L client
```

**Pods in production but NOT client xyz:**
```bash
kubectl get pods -l "env=prod,client!=xyz" -L env -L client
```

**Pods in dev or test environment:**
```bash
kubectl get pods -l "env in (dev,test)" -L env
```

**Pods NOT in dev or test environment:**
```bash
kubectl get pods -l "env notin (dev,test)" -L env
```

### Delete Pods by Labels
```bash
kubectl delete pods -l "client=abc"
``` 
