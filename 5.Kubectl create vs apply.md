# kubectl create vs apply

## Overview

- **`kubectl create`**: Creates resources but does not store the last applied configuration in etcd
- **`kubectl apply`**: Best practice - creates or updates resources and stores the configuration for future comparisons

## Inspecting Pod Configurations

### Check Live Object Configuration
```bash
kubectl get pod webapp -o yaml
```

### View Pod Labels
```bash
kubectl get pods --show-labels
```

### Add Labels to Pods
```bash
kubectl label pod test client=abc
```

### Verify Label Addition
```bash
kubectl get pods test -o yaml
```

## Resource Management

### CPU Limits and Requests
- **Requests**: Guaranteed minimum CPU allocation
- **Limits**: Maximum CPU a container can use
- Used by Kubernetes scheduler for pod placement and resource management

## Context Switching

### Types of Context Switches
- **Voluntary Context Switching**: Process willingly gives up CPU (e.g., waiting for I/O)
- **Involuntary Context Switching**: Process is preempted by the scheduler

### Performance Monitoring Example

**High CPU Usage Test:**
```bash
/usr/bin/time -v dd if=/dev/zero of=/tmp/bigfile bs=1M count=500
```

**Sample Output:**
```
500+0 records in
500+0 records out
524288000 bytes (524 MB, 500 MiB) copied, 0.274666 s, 1.9 GB/s
    Command being timed: "dd if=/dev/zero of=/tmp/bigfile bs=1M count=500"
    User time (seconds): 0.00
    System time (seconds): 0.34
    Percent of CPU this job got: 99%
    Elapsed (wall clock) time (h:mm:ss or m:ss): 0:00.34
    Average shared text size (kbytes): 0
    Average unshared data size (kbytes): 0
    Average stack size (kbytes): 0
    Average total size (kbytes): 0
    Maximum resident set size (kbytes): 2816
    Average resident set size (kbytes): 0
    Major (requiring I/O) page faults: 0
    Minor (reclaiming a frame) page faults: 346
    Voluntary context switches: 1
    Involuntary context switches: 40
    Swaps: 0
    File system inputs: 0
    File system outputs: 1024000
    Socket messages sent: 0
    Socket messages received: 0
    Signals delivered: 0
    Page size (bytes): 4096
    Exit status: 0
```

**Disk Usage Check:**
```bash
/usr/bin/time -v df -h
```

## Key Differences: create vs apply

| Aspect | kubectl create | kubectl apply |
|--------|----------------|---------------|
| Configuration Storage | No last-applied-config annotation | Stores last-applied-config in etcd |
| Updates | Cannot update existing resources | Can update existing resources |
| Use Case | One-time resource creation | Declarative resource management |
| Best Practice | Avoid for production | Preferred for production |

## Best Practices

- Use `kubectl apply` for declarative resource management
- Always specify resource requests and limits
- Use labels for organizing and selecting resources
- Monitor context switching for performance optimization
